<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Lamm Consulting AB </title>
  <meta property="og:title" content="Lamm Consulting AB " />
  <meta name="twitter:title" content="Lamm Consulting AB " />
  <meta name="description" content="Overview The BOM Resolver could be used both as a tool and a service which make it useful for both the single developer and a large enterprises.
The name resolver indicates that this project is about backtracking the Alpine eco system.
The difference between this project and other projects such as Wolfi project is the compliance with Alpine build formats.
Flow Red indicates software retrieved from Internet that not have been analyzed, green represented analyzed source being rebuilt.">
  <meta property="og:description" content="Overview The BOM Resolver could be used both as a tool and a service which make it useful for both the single developer and a large enterprises.
The name resolver indicates that this project is about backtracking the Alpine eco system.
The difference between this project and other projects such as Wolfi project is the compliance with Alpine build formats.
Flow Red indicates software retrieved from Internet that not have been analyzed, green represented analyzed source being rebuilt.">
  <meta name="twitter:description" content="Overview The BOM Resolver could be used both as a tool and a service which make it useful for both the single developer and a large enterprises.
The name resolver indicates that this project is about â€¦">
  <meta name="author" content="Hans Thorsen Lamm"/>
  <link href='https://lammda.se/img/favicon.ico' rel='icon' type='image/x-icon'/>
  <meta property="og:image" content="https://lammda.se/img/avatar-icon.png" />
  <meta name="twitter:image" content="https://lammda.se/img/avatar-icon.png" />
  <meta name="twitter:card" content="summary" />
  <meta property="og:url" content="https://lammda.se/" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Lamm Consulting AB " />

  <meta name="generator" content="Hugo 0.92.2" />
  <link rel="canonical" href="https://lammda.se/" />
  <link rel="alternate" href="https://lammda.se/index.xml" type="application/rss+xml" title="Lamm Consulting AB ">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css" integrity="sha384-wITovz90syo1dJWVh32uuETPVEtGigN07tkttEqPv+uR2SE/mbQcG7ATL28aI9H0" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="https://lammda.se/css/main.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  <link rel="stylesheet" href="https://lammda.se/css/pygment_highlights.css" />
  <link rel="stylesheet" href="https://lammda.se/css/highlight.min.css" />

</head>

  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://lammda.se/">Lamm Consulting AB </a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="Build" href="https://lammda.se/start/">Build</a>
            </li>
          
        
          
            <li>
              <a title="SBOM" href="https://lammda.se/sbom/">SBOM</a>
            </li>
          
        
          
            <li>
              <a title="Donations" href="https://lammda.se/donations/">Donations</a>
            </li>
          
        
          
            <li>
              <a title="Events" href="https://lammda.se/events/">Events</a>
            </li>
          
        

        

        
      </ul>
    </div>

    <div class="avatar-container">
      <div class="avatar-img-border">
        
          <a title="Lamm Consulting AB " href="https://lammda.se/">
            <img class="avatar-img" src="https://lammda.se/img/avatar-icon.png" alt="Lamm Consulting AB " />
          </a>
        
      </div>
    </div>

  </div>
</nav>




    
  
  
  




  

  <header class="header-section ">
    
    <div class="intro-header no-img">
      
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="page-heading">
              <h1>Lamm Consulting AB </h1>
                
                  
                    <hr class="small">
                    <span class="page-subheading">SBOM for isolated rebuild of Alpine packages</span>
                  
                
                
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


    
  <div role="main" class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        
          <div class="well">
            <h2 id="overview">Overview</h2>
<p>The BOM Resolver could be used both as a <a href="tool.txt">tool</a>  and a <a href="https://services.lammda.se/resolver/alpine/v1/ui">service</a>
which make it useful for both the single developer and a large enterprises.</p>
<p>The name resolver indicates that this project is about backtracking the Alpine eco system.</p>
<p>The difference between this project and other projects such as  <a href="https://edu.chainguard.dev/open-source/wolfi/overview/">Wolfi</a> project is
the compliance with <a href="https://wiki.alpinelinux.org/wiki/APKBUILD_Reference">Alpine build formats</a>.</p>
<h2 id="flow">Flow</h2>
<p>Red indicates software retrieved from Internet that not have been analyzed, green represented analyzed  source being rebuilt. The resolver consist of two containers.</p>
<ul>
<li>Build a docker image by specifying list of packages ( &ldquo;packages&rdquo;)</li>
<li>Use the metadata created ( aggregated.json ) together with Alpine build manifest to created the resolved.json</li>
</ul>
<p>Mirroring of source and binaries is optional, but  dont expose developers using FOSS.</p>
<p><img src="bomresolver.png" alt="Overview"></p>
<p><a href="https://www.alpinelinux.org/">Alpine Linux</a> aggregates open source projects by</p>
<ul>
<li>Compile source code into binaries</li>
<li>Provides binaries as packages</li>
<li>Support for many architectures
<ul>
<li>X86</li>
<li>ARM</li>
</ul>
</li>
</ul>
<p>Without aggregation, developers must build the binaries from source on their own.
For embedded systems frameworks such as <a href="https://buildroot.org/">Buildroot</a>, <a href="https://www.yoctoproject.org/">Yoctoproject</a> and <a href="https://www.ptxdist.org/">PTXDIST</a> exists.</p>
<table>
<thead>
<tr>
<th>Repository</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Public binary packages</td>
<td><a href="http://dl-cdn.alpinelinux.org/alpine">http://dl-cdn.alpinelinux.org/alpine</a></td>
</tr>
<tr>
<td>Mirror of public repository</td>
<td><a href="https://services.lammda.se/alpine/public/">https://services.lammda.se/alpine/public/</a></td>
</tr>
<tr>
<td>Isolated rebuild of packages</td>
<td><a href="https://services.lammda.se/alpine/approved/">https://services.lammda.se/alpine/approved/</a></td>
</tr>
<tr>
<td>Customized packages</td>
<td><a href="https://services.lammda.se/alpine/custom/">https://services.lammda.se/alpine/custom/</a></td>
</tr>
</tbody>
</table>
<h2 id="workflow">Workflow</h2>
<h3 id="binary-build">Binary build</h3>
<p>docker.io/bomres/base_os_alpine use two config files as input and generates a container.
The first file is the list of all  <a href="desired.txt"><strong>desired</strong></a>  packages.
<a href="settings.txt"><strong>settings</strong></a> file defines which version of Alpine among other settings.</p>
<p>Start with the <a href="desired.txt"><strong>desired</strong></a> list of <em>binary</em> packages</p>
<ul>
<li>The package manager resolve all <a href="os.apk.txt"><strong>binary</strong></a> dependencies.</li>
<li>APKINDEX.tar.gz enrich the file above into <a href="aggregated.json"><strong>aggregated.json</strong></a>.</li>
<li>The container is built twice.
<ul>
<li>First pass against remote repository ( see table above )</li>
<li>Second pass from <a href="download.txt">local disk</a></li>
</ul>
</li>
</ul>
<h3 id="resolve-binary">Resolve binary</h3>
<p>When all metadata are stored locally in a consistent state, the backtrack
process could be executed.</p>
<p>docker.io/bomres/alpine_resolver is the second container it takes <a href="aggregated.json"><strong>aggregated.json</strong></a>. as
input and cross check against <a href="https://github.com/alpinelinux/aports">aports</a>.</p>
<p>The cross check between the package manager and the build manifest results in <a href="resolved.json">resolved.json</a>.</p>
<p>Please note that the purpose of this project is about</p>
<ul>
<li>Generate a complete SBOM from a binary build.</li>
<li>Rebuild the binaries in isolation based on SBOM.</li>
</ul>
<p>This approach is also a proof of correctness of the SBOM, when done the content could
be exported to <a href="https://spdx.dev/">SPDX</a>, <a href="https://cyclonedx.org">Cyclone DX</a>, etc.</p>
<h3 id="iterate-for-depth">Iterate for depth</h3>
<p>Dependencies for the base layer in microservices ends with the linux kernel interface.</p>
<p>it is similar to ancestry, either you go wide by generation, or deep following one specific branch.</p>
<p><a href="https://www.cisa.gov/sites/default/files/publications/Dec15-SBOM-a-rama-slides.pdf">CISA</a> have a paper about depth and effectiveness.  The resolved.json file have a section that indicates if</p>
<p>all branches have been resolved or not.</p>
<pre tabindex="0"><code>        &quot;resolver&quot;: {
            &quot;status&quot;: false,

</code></pre><p>Currently this is not automated in the resolver, but it is possible. New dependencies found by the resolver must be added to the
desired sbom so it covers all <a href="iterate.txt">packages</a> in the product. Alpine promote flexibility and therefore <a href="https://www.lighttpd.net/">lighttpd</a> supports
<a href="https://www.openldap.org/">openldap</a>.</p>
<p>The APKBUILD file controls how lighttpd is built</p>
<pre tabindex="0"><code> build() {
        ./configure \
                --without-gdbm \
                --with-pcre2 \
                --with-dbi \
                --with-ldap \
                --with-openssl \
                --with-zstd \
                --with-brotli \
                --with-lua
        make
</code></pre><p>Using buildroot, ptxdist etc this package could be optimized for <a href="https://kubernetes.io/">Kubernetes</a> which provides functionality not needed in the build.</p>
<p>However there is a tradeoff of being compliant with Alpines package strategy or customization/hardening.</p>
<h3 id="download-source-code-for-product">Download source code for product</h3>
<p>When the resolver reports true, it is time to download all source code required to build.</p>
<ul>
<li>External packages *.tar.gz</li>
<li>External patches</li>
<li>Contributions by Alpine
<ul>
<li>Patches</li>
<li>Build manifests ( APKBUILD)</li>
<li>Additional files</li>
</ul>
</li>
</ul>
<p>All downloaded files are adjusted for rebuild and stored in the <a href="source.txt">source directory</a></p>
<h3 id="analyze-code">Analyze code</h3>
<p>The resolver just prepare the code for analyze.  To comply with different standards the analyze should cover many aspects, such as composition, legal and security.</p>
<p>Patches are a little bit tricky to analyze.</p>
<p>One option to analyze patches is</p>
<ul>
<li>unpack and analyze the original source</li>
<li>store report of analyze ( analyze-1 )</li>
<li>apply patches to the source</li>
<li>analyze the source code again</li>
<li>store the report as ( analyze-2 )</li>
<li>compare the the two analyze reports.</li>
</ul>
<p>if analyze-1 reports security issues and analyze-2 not, we could assume that the patch improved security.</p>
<p>if analyze-1 reports security issues and analyze-2 still reports issues, the patch was of no use.</p>
<p>if analyze-1 reports no security issues, but analyze-2 does, when the patch is an attack.</p>
<h3 id="prepare-build-tool">Prepare build tool</h3>
<p>Rootless <a href="https://podman.io">Podman</a> is required to use the resolver. This enable build to be executed as root inside the container, but still execute as a normal
user on the host.</p>
<p>For scalabity build jobs could be deployed as pods in Kubernetes. With overlay file system temporary files could be kept locally.</p>
<p>Alpine supports many targets such as X86 and ARM, the tool should therefore be containerized.</p>
<p>The tool must be adopted for the product being built. The Bom resolver generates a package list for the <a href="tools.txt">tool</a> similar to the
<a href="desired.txt">product</a>.</p>
<h3 id="to-be-continued">To be continued</h3>
<h2 id="heading"></h2>
<p>Presentation of Alpine Bom Resolver at <a href="https://archive.fosdem.org/2022/schedule/event/sbom_resolver_generating_detailed_sboms_for_alpine/">Fossdem 2022</a></p>
<p>The source code is submitted under Apache License 2.0 as open source on  <a href="https://github.com/Nordix/bomres">Github</a></p>

          </div>
        

        <div class="posts-list">
          
          
            <article class="post-preview">
              <a href="https://lammda.se/post/">
                <h2 class="post-title">Posts</h2>
                
              </a>

              <span class="post-meta">
  
  
</span>


              <div class="post-entry">
                
                  
                
              </div>

              
            </article>
          
        </div>

        
      </div>
    </div>
  </div>

    <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
                <a href="mailto:hans@lammda.se" title="Email me">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://gitlab.com/hans-lammda" title="GitLab">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fab fa-gitlab fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://github.com/hans-lammda" title="GitHub">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://linkedin.com/in/hans-thorsen-b76411244/" title="LinkedIn">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
        </ul>
        <p class="credits copyright text-muted">
          Hans Thorsen Lamm
          &nbsp;&bull;&nbsp;
          2017

          
            &nbsp;&bull;&nbsp;
            <a href="https://lammda.se/">Lamm Consulting AB </a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="http://gohugo.io">Hugo v0.92.2</a> powered &nbsp;&bull;&nbsp; Theme by <a href="http://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a> adapted to <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a>
          
        </p>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.js" integrity="sha384-/y1Nn9+QQAipbNQWU65krzJralCnuOasHncUFXGkdwntGeSvQicrYkiUBwsgUqc1" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/contrib/auto-render.min.js" integrity="sha384-dq1/gEHSxPZQ7DdrM82ID4YVol9BYyU7GbWlIwnwyPzotpoc57wDw/guX8EaYGPx" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="https://lammda.se/js/main.js"></script>
<script src="https://lammda.se/js/highlight.min.js"></script>
<script> hljs.initHighlightingOnLoad(); </script>
<script> renderMathInElement(document.body); </script>





  </body>
</html>

